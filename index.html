<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pendaftaran OSIS Baru</title>
    <script src="https://cdn.ably.com/lib/ably.min-1.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #0f172a;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px 20px;
            margin: 0;
        }
        .form-card {
            background: #1e293b;
            padding: 30px;
            border-radius: 20px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            border: 1px solid #334155;
        }
        h2 { text-align: center; color: #38bdf8; margin-bottom: 25px; }
        .input-group { margin-bottom: 18px; }
        label { display: block; font-size: 0.85rem; margin-bottom: 8px; color: #94a3b8; font-weight: 600; }
        input, textarea, select {
            width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #334155;
            background: #0f172a; color: white; outline: none; box-sizing: border-box;
        }
        input:focus { border-color: #38bdf8; }
        .promise-box {
            background: rgba(56, 189, 248, 0.1); padding: 15px; border-radius: 8px;
            border-left: 4px solid #38bdf8; font-style: italic; font-size: 0.9rem; margin: 20px 0;
        }
        .parent-check {
            background: #16213e; padding: 15px; border-radius: 8px; border: 1px dashed #38bdf8;
        }
        button {
            width: 100%; padding: 15px; border-radius: 10px; border: none;
            background: #38bdf8; color: #0f172a; font-weight: bold; cursor: pointer;
            margin-top: 20px; font-size: 1rem; transition: 0.3s;
        }
        button:hover { background: #7dd3fc; transform: translateY(-2px); }
    </style>
</head>
<body>

<div class="form-card">
    <h2>Formulir Calon Pengurus</h2>
    
    <div class="input-group">
        <label>Nama Lengkap</label>
        <input type="text" id="nama" placeholder="Ketik nama lengkap...">
    </div>

    <div class="input-group">
        <label>Kelas</label>
        <input type="text" id="kelas" placeholder="Contoh: X-F1 atau XI-MIPA">
    </div>

    <div class="input-group">
        <label>Nomor WhatsApp</label>
        <input type="tel" id="wa" placeholder="0812xxxxxxxx">
    </div>

    <div class="input-group">
        <label>Visi & Misi</label>
        <textarea id="visi" rows="3" placeholder="Apa tujuanmu?"></textarea>
    </div>

    <div class="input-group">
        <label>Alasan Masuk OSIS</label>
        <textarea id="alasan" rows="3" placeholder="Kenapa kamu ingin bergabung?"></textarea>
    </div>

    <div class="promise-box">
        "Saya berjanji akan bersungguh-sungguh dalam menjalankan segala tugas di OSIS."
    </div>

    <div class="input-group">
        <label style="color: #fb7185;">* Tulis ulang janji di atas untuk verifikasi:</label>
        <input type="text" id="janji_input" placeholder="Ketik ulang kalimat janji...">
    </div>

    <div class="parent-check">
        <label>Persetujuan Orang Tua:</label>
        <select id="izin_ortu">
            <option value="">-- Pilih Jawaban --</option>
            <option value="Setuju">Ya, Orang Tua Menyetujui</option>
            <option value="Tidak Setuju">Tidak Menyetujui</option>
        </select>
    </div>

    <button id="btnKirim">Kirim Pendaftaran</button>
</div>

<script>
    // Menggunakan API Key yang kamu berikan
    const API_KEY = '8FikgA.l09CGA:bAYKxr1SyBf-iGK412YaqEjNjh42ddlwNknnz5pAUa4';
    const ably = new Ably.Realtime(API_KEY);
    const channel = ably.channels.get('osis-stream');

    // Notifikasi ke Dashboard saat siswa baru buka web
    ably.connection.on('connected', () => {
        channel.publish('masuk', { info: 'Siswa sedang mengisi form' });
    });

    document.getElementById('btnKirim').onclick = function() {
        const data = {
            nama: document.getElementById('nama').value,
            kelas: document.getElementById('kelas').value,
            wa: document.getElementById('wa').value,
            visi: document.getElementById('visi').value,
            alasan: document.getElementById('alasan').value,
            janji: document.getElementById('janji_input').value,
            izin: document.getElementById('izin_ortu').value
        };

        // Validasi sederhana
        if(!data.nama || !data.wa || !data.janji || !data.izin) {
            alert('Mohon lengkapi semua data dan persetujuan!');
            return;
        }

        // Kirim data ke Dashboard Admin (Ably)
        channel.publish('pendaftaran-baru', data);
        
        alert('Terima kasih ' + data.nama + ', pendaftaranmu sudah masuk ke sistem!');
        location.reload(); // Refresh setelah kirim
    };

    // Notifikasi ke Dashboard saat siswa menutup halaman
    window.addEventListener('beforeunload', () => {
        channel.publish('keluar', { info: 'Siswa meninggalkan form' });
    });
</script>

</body>
</html>
